<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Meta Description -->
    <meta name="description" content="Generate stunning AI art with multiple styles - from photorealistic to anime, cyberpunk to Studio Ghibli. Create professional photography, digital art, oil paintings and more with advanced AI image generation.">

    <!-- Meta Theme Color (sesuai warna primary di CSS) -->
    <meta name="theme-color" content="#6c5ce7">
    <meta name="msapplication-navbutton-color" content="#6c5ce7">
    <meta name="apple-mobile-web-app-status-bar-style" content="#6c5ce7">

    <!-- Open Graph / Social Media Meta (opsional tapi recommended) -->
    <meta property="og:title" content="RuangRiung AI Image Generator - Create Stunning Digital Art">
    <meta property="og:description" content="Transform text into beautiful AI-generated artwork in various styles including photography, anime, digital painting and more.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ruangriung.my.id">
    <meta property="og:image" content="assets/logo.webp">
    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="logo.png">
    <link rel="icon" type="image/png" sizes="32x32" href="logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="logo.png">
    <title>RuangRiung AI Image Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6c5ce7;
            --primary-dark: #5649c0;
            --primary-light: #a29bfe;
            --bg: #e0e5ec;
            --shadow-light: #ffffff;
            --shadow-dark: #a3b1c6;
            --text: #2d3436;
            --text-light: #636e72;
            --success: #00b894;
            --danger: #d63031;
            --warning: #fdcb6e;
        }
        
        .dark-mode {
            --primary: #a29bfe;
            --primary-dark: #847bd1;
            --primary-light: #6c5ce7;
            --bg: #2d3436;
            --shadow-light: #3c4245;
            --shadow-dark: #1e2224;
            --text: #dfe6e9;
            --text-light: #b2bec3;
            --success: #55efc4;
            --danger: #ff7675;
            --warning: #ffeaa7;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .container {
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
            flex: 1;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 2.2rem;
            text-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
        }
        
        .subtitle {
            color: var(--text-light);
            font-weight: 300;
            margin-bottom: 20px;
        }
        
        .dark-mode-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            cursor: pointer;
            padding: 10px 20px;
            border-radius: 15px;
            background: var(--bg);
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            transition: all 0.3s ease;
        }
        
        .dark-mode-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 8px 8px 15px var(--shadow-dark), -8px -8px 15px var(--shadow-light);
        }
        
        .dark-mode-toggle i {
            font-size: 16px;
        }
        
        .card {
            background: var(--bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 8px 8px 15px var(--shadow-dark), -8px -8px 15px var(--shadow-light);
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 12px 12px 20px var(--shadow-dark), -12px -12px 20px var(--shadow-light);
        }
        
        .input-group {
            display: flex;
            margin-bottom: 25px;
            position: relative;
        }
        
        #prompt-textarea {
            flex: 1;
            padding: 16px 20px 16px 50px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            outline: none;
            background: var(--bg);
            box-shadow: inset 3px 3px 5px var(--shadow-dark), inset -3px -3px 5px var(--shadow-light);
            color: var(--text);
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            min-height: 100px;
            resize: vertical;
        }
        
        #prompt-textarea:focus {
            box-shadow: inset 5px 5px 8px var(--shadow-dark), inset -5px -5px 8px var(--shadow-light);
        }
        
        .input-icon {
            position: absolute;
            left: 20px;
            top: 20px;
            color: var(--primary);
            font-size: 16px;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .input-buttons {
            display: flex;
            gap: 15px;
            margin-left: 15px;
        }
        
        #generate-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 0 25px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 140px;
            justify-content: center;
            height: 52px;
        }
        
        #enhance-btn {
            background: var(--bg);
            color: var(--primary);
            border: none;
            padding: 0 20px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 52px;
            justify-content: center;
            height: 52px;
        }
        
        #generate-btn i, #enhance-btn i {
            font-size: 16px;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #generate-btn:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-2px);
        }
        
        #enhance-btn:hover {
            background: var(--shadow-light);
            transform: translateY(-2px);
        }
        
        #generate-btn:active, #enhance-btn:active {
            transform: translateY(0);
            box-shadow: inset 3px 3px 5px rgba(0, 0, 0, 0.2), inset -3px -3px 5px rgba(255, 255, 255, 0.1);
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .setting-group {
            position: relative;
            margin: 8px 5px;            
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .select-container {
            position: relative;
            width: 100%;
        }
        
        select {
            width: 100%;
            padding: 15px 15px 15px 40px;
            border: none;
            border-radius: 15px;
            background: var(--bg);
            box-shadow: inset 3px 3px 5px var(--shadow-dark), inset -3px -3px 5px var(--shadow-light);
            appearance: none;
            outline: none;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            height: 50px;
        }
        
        .select-container::after {
            content: "\f078";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: var(--primary);
        }
        
        .select-container i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 14px;
        }
        
        select:focus {
            box-shadow: inset 5px 5px 8px var(--shadow-dark), inset -5px -5px 8px var(--shadow-light);
        }
        
        .number-input-container {
            position: relative;
            width: 100%;
        }
        
        .number-input-container i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 14px;
        }
        
        #seed {
            width: 100%;
            padding: 15px 15px 15px 40px;
            border: none;
            border-radius: 15px;
            background: var(--bg);
            box-shadow: inset 3px 3px 5px var(--shadow-dark), inset -3px -3px 5px var(--shadow-light);
            font-size: 14px;
            outline: none;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
            height: 50px;
        }
        
        #seed:focus {
            box-shadow: inset 5px 5px 8px var(--shadow-dark), inset -5px -5px 8px var(--shadow-light);
        }
        
        .slider-container {
            width: 100%;
            padding: 15px;
            border-radius: 15px;
            background: var(--bg);
            box-shadow: inset 3px 3px 5px var(--shadow-dark), inset -3px -3px 5px var(--shadow-light);
        }
        
        .slider-group {
            margin-bottom: 15px;
        }
        
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            outline: none;
            margin: 10px 0;
            --range-percent: 50%;
            background: linear-gradient(to right, var(--primary) 0%, var(--primary) var(--range-percent), var(--shadow-dark) var(--range-percent), var(--shadow-dark) 100%);
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border: 3px solid white;
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border: 3px solid white;
        }
        
        .slider-value-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 5px;
        }
        
        .slider-value {
            font-weight: 600;
            color: var(--primary);
            min-width: 30px;
            text-align: center;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-light);
            margin-top: 5px;
        }
        
        .dimension-slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .dimension-slider {
            flex: 1;
        }
        
        .dimension-value {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
            color: var(--primary);
        }
        
        .aspect-ratio-display {
            text-align: center;
            font-size: 14px;
            color: var(--text-light);
            margin-top: 5px;
        }
        
        .advanced-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            cursor: pointer;
            padding: 12px 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
            background: var(--bg);
            box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
        }
        
        .advanced-toggle:hover {
            background: rgba(108, 92, 231, 0.1);
        }
        
        .advanced-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }
        
        .advanced-content.show {
            max-height: 1000px;
        }
        
        .checkbox-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
            background: var(--bg);
            box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
        }
        
        .checkbox-group:hover {
            transform: translateY(-2px);
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
        }
        
        .checkbox-group input {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
        }
        
        .checkbox-group label {
            margin-bottom: 0;
            flex: 1;
        }
        
        .image-container {
            background: var(--bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 8px 8px 15px var(--shadow-dark), -8px -8px 15px var(--shadow-light);
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
        }
        
        #generated-image {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 15px;
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            display: none;
            object-fit: contain;
            background: rgba(255, 255, 255, 0.3);
            padding: 10px;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 30px 0;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--bg);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            width: 100%;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 20px;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            font-family: 'Poppins', sans-serif;
            flex: 1;
            min-width: 120px;
            justify-content: center;
        }
        
        .btn i {
            font-size: 14px;
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: var(--bg);
            color: var(--primary);
        }
        
        .btn-secondary:hover {
            background: var(--shadow-light);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: var(--bg);
            color: var(--danger);
        }
        
        .btn-danger:hover {
            background: rgba(214, 48, 49, 0.1);
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
            box-shadow: inset 3px 3px 5px rgba(0, 0, 0, 0.2), inset -3px -3px 5px rgba(255, 255, 255, 0.1);
        }
        
        .error-message {
            color: var(--danger);
            text-align: center;
            margin-top: 20px;
            font-weight: 500;
            display: none;
            padding: 15px;
            border-radius: 15px;
            background: var(--bg);
            box-shadow: inset 3px 3px 5px var(--shadow-dark), inset -3px -3px 5px var(--shadow-light);
        }
        
        .history-panel {
            margin-top: 30px;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .history-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg);
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
        }
        
        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: 8px 8px 15px var(--shadow-dark), -8px -8px 15px var(--shadow-light);
        }
        
        .history-thumbnail {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            object-fit: cover;
            margin-right: 15px;
            box-shadow: 2px 2px 5px var(--shadow-dark), -2px -2px 5px var(--shadow-light);
        }
        
        .history-prompt {
            flex: 1;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .history-date {
            font-size: 12px;
            color: var(--text-light);
            margin-left: 15px;
        }
        
        .saved-prompts-panel {
            margin-top: 30px;
            display: none;
        }
        
        .saved-prompt-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg);
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            justify-content: space-between;
        }
        
        .saved-prompt-item:hover {
            transform: translateY(-2px);
            box-shadow: 8px 8px 15px var(--shadow-dark), -8px -8px 15px var(--shadow-light);
        }
        
        .saved-prompt-text {
            flex: 1;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .saved-prompt-actions {
            display: flex;
            gap: 10px;
            margin-left: 15px;
        }
        
        .saved-prompt-action {
            color: var(--primary);
            cursor: pointer;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: var(--bg);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 8px 8px 15px var(--shadow-dark), -8px -8px 15px var(--shadow-light);
            max-width: 500px;
            width: 90%;
            transition: all 0.3s ease;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 600;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }
        
        .modal-body {
            margin-bottom: 20px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .api-key-input {
            width: 100%;
            padding: 15px;
            border-radius: 15px;
            border: none;
            background: var(--bg);
            box-shadow: inset 3px 3px 5px var(--shadow-dark), inset -3px -3px 5px var(--shadow-light);
            color: var(--text);
            font-family: 'Poppins', sans-serif;
            margin-bottom: 15px;
        }
        
        .api-key-input:focus {
            outline: none;
            box-shadow: inset 5px 5px 8px var(--shadow-dark), inset -5px -5px 8px var(--shadow-light);
        }
        
        .modal-btn {
            padding: 10px 20px;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-family: 'Poppins', sans-serif;
        }
        
        .modal-btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }
        
        .modal-btn-secondary {
            background: var(--bg);
            color: var(--primary);
            box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
        }
        
        .modal-btn:active {
            transform: translateY(0);
        }
        
        .text-muted {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: var(--text-light);
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .input-buttons {
                margin-left: 0;
                margin-top: 15px;
                width: 100%;
            }
            
            #generate-btn, #enhance-btn {
                width: 100%;
                justify-content: center;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .checkbox-container {
                gap: 10px;
            }
            
            .checkbox-group {
                padding: 10px 12px;
            }
            
            .advanced-toggle {
                padding: 10px 12px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .modal-footer {
                flex-direction: column;
            }
            
            .modal-btn {
                width: 100%;
            }
        }
        .checkbox-group {
    display: flex;
    align-items: center;
    padding: 12px 15px;
    border-radius: 10px;
    transition: all 0.3s ease;
    background: var(--bg);
    box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
    margin-bottom: 10px;
}

.checkbox-group:hover {
    transform: translateY(-2px);
    box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
}

.checkbox-group input {
    margin-right: 10px;
    width: 18px;
    height: 18px;
    accent-color: var(--primary);
}

.checkbox-group label {
    margin-bottom: 0;
    flex: 1;
    display: flex;
    align-items: center;
    gap: 8px;
}
        .note {
    font-size: 12px;
    color: var(--text-light);
    margin-top: 5px;
    font-style: italic;
}
#clear-btn {
    background: var(--bg);
    color: var(--danger);
    border: none;
    padding: 0 20px;
    border-radius: 15px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
    min-width: 52px;
    justify-content: center;
    height: 35px;
    margin-bottom: 15px;
}

#clear-btn i {
    font-size: 16px;
    width: 16px;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
}

#clear-btn:hover {
    background: rgba(214, 48, 49, 0.1);
    transform: translateY(-2px);
}

#clear-btn:active {
    transform: translateY(0);
    box-shadow: inset 3px 3px 5px rgba(0, 0, 0, 0.2), inset -3px -3px 5px rgba(255, 255, 255, 0.1);
}
footer {
    text-align: center;
    margin-top: 30px;
    padding: 20px;
    color: var(--text-light);
    font-size: 14px;
}

.footer-link {
    color: var(--primary);
    text-decoration: none;
    transition: color 0.3s ease;
}

.footer-link:hover {
    color: var(--primary-dark);
    text-decoration: underline;
}

.dark-mode .footer-link {
    color: var(--primary-light);
}

.dark-mode .footer-link:hover {
    color: var(--primary);
}

.footer-reset-btn {
    display: block;
    margin: 15px auto 15px;
    padding: 8px 16px;
    background: var(--bg);
    color: var(--danger);
    border: none;
    border-radius: 15px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
    transition: all 0.3s ease;
    font-family: 'Poppins', sans-serif;
}

.footer-reset-btn:hover {
    background: rgba(214, 48, 49, 0.1);
    transform: translateY(-2px);
}

.footer-reset-btn:active {
    transform: translateY(0);
    box-shadow: inset 2px 2px 4px rgba(0, 0, 0, 0.2), inset -2px -2px 4px rgba(255, 255, 255, 0.1);
}

.footer-reset-btn i {
    margin-right: 5px;
}
.batch-controls {
    margin-bottom: 25px;
    padding: 15px;
    border-radius: 15px;
    background: var(--bg);
    box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
}

.batch-input-container {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

.batch-input-container input {
    flex: 1;
    padding: 12px 15px;
    border: none;
    border-radius: 15px;
    background: var(--bg);
    box-shadow: inset 3px 3px 5px var(--shadow-dark), inset -3px -3px 5px var(--shadow-light);
    color: var(--text);
    font-family: 'Poppins', sans-serif;
    text-align: center;
}

/* Responsive styles */
@media (max-width: 768px) {
    .batch-input-container {
        flex-direction: column;
    }
    
    .batch-input-container input {
        width: 100%;
    }
    
    #batch-generate-btn {
        width: 100%;
    }
}
.batch-images-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
    width: 100%;
    margin: 20px 0;
}

.batch-image {
    width: 100%;
    height: auto;
    border-radius: 10px;
    cursor: pointer;
    transition: transform 0.3s ease;
    box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
}

.batch-image:hover {
    transform: scale(1.05);
}

@media (max-width: 768px) {
    .batch-images-container {
        grid-template-columns: repeat(2, 1fr);
    }
}
.floating-facebook-btn {
    position: fixed;
    bottom: 20px;
    left: 20px; /* pindahkan ke kiri */
    background: #1877f2;
    color: white;
    font-size: 20px;
    width: 50px;
    height: 50px;
    border-radius: 50%; /* buat lingkaran sempurna */
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
    z-index: 999;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    text-decoration: none;
}

.floating-facebook-btn:hover {
    transform: scale(1.1);
    box-shadow: 8px 8px 15px var(--shadow-dark), -8px -8px 15px var(--shadow-light);
}
html {
    scroll-behavior: smooth;
}
.prompt-suggestions-container {
    margin-bottom: 15px;
    align-items: center;
}

.prompt-suggestions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 10px;
}

.prompt-suggestion {
    background: var(--bg);
    color: var(--primary);
    border: none;
    padding: 8px 12px;
    border-radius: 15px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
}

.prompt-suggestion:hover {
    background: var(--primary-light);
    color: white;
    transform: translateY(-2px);
}

.prompt-suggestion i {
    font-size: 12px;
}

.suggestions-loading {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-light);
    font-size: 14px;
}

.suggestions-loading .spinner {
    width: 16px;
    height: 16px;
    border: 2px solid var(--bg);
    border-top: 2px solid var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

.refresh-suggestions {
    background: none;
    border: none;
    color: var(--primary);
    cursor: pointer;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 5px;
    margin-top: 5px;
}

.refresh-suggestions:hover {
    text-decoration: underline;
}
.expand-btn {
    position: absolute;
    right: 15px;
    top: 15px;
    background: none;
    border: none;
    color: var(--primary);
    cursor: pointer;
    font-size: 16px;
    z-index: 2;
    display: none;
}

@media (max-width: 768px) {
    .expand-btn {
        display: block;
    }
    
    #prompt-textarea {
        padding-right: 40px;
    }
}

#fullscreen-textarea {
    background: var(--bg);
    color: var(--text);
    font-family: 'Poppins', sans-serif;
    font-size: 16px;
    outline: none;
}
        @media (max-width: 768px) {
    #prompt-textarea {
        min-height: 160px; /* Tinggi minimum yang lebih besar untuk mobile */
        padding-right: 15px; /* Ruang untuk tombol expand */
    }

    .input-group {
        position: relative; /* Untuk positioning tombol expand */
    }

    .expand-btn {
        display: block; /* Tampilkan tombol expand */
        position: absolute;
        right: 10px;
        bottom: 10px;
        background: var(--primary);
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 2px 2px 5px var(--shadow-dark);
    }
        }

/* Language Toggle Styles */
.language-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
    cursor: pointer;
    padding: 10px 20px;
    border-radius: 15px;
    background: var(--bg);
    box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
    transition: all 0.3s ease;
}

.language-toggle:hover {
    transform: translateY(-2px);
    box-shadow: 8px 8px 15px var(--shadow-dark), -8px -8px 15px var(--shadow-light);
}

.language-toggle i {
    font-size: 16px;
}

.language-option {
    padding: 5px 10px;
    border-radius: 10px;
    transition: all 0.3s ease;
}

.language-option.active {
    background: var(--primary);
    color: white;
}

.language-option:not(.active):hover {
    background: var(--shadow-light);
}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-magic-wand-sparkles"></i> RuangRiung AI Image Generator</h1>
            <p class="subtitle">Transform your imagination into stunning visuals with AI</p>
        </header>
        
        <div class="dark-mode-toggle" id="dark-mode-toggle">
            <i class="fas fa-moon"></i>
            <span>Dark Mode</span>
        </div>
        
        <div class="language-toggle" id="language-toggle">
            <div class="language-option active" id="lang-en">
                <i class="fas fa-language"></i> English
            </div>
            <div class="language-option" id="lang-id">
                <i class="fas fa-language"></i> Bahasa
            </div>
        </div>
        
        <div class="card">
        	<div class="prompt-suggestions-container">
    <div class="prompt-suggestions" id="prompt-suggestions"></div>
    <div class="suggestions-loading" id="suggestions-loading" style="display: none;">
        <div class="spinner"></div>
        <span>Generating creative prompts...</span>
    </div>
    <button class="refresh-suggestions" id="refresh-suggestions">
        <i class="fas fa-sync-alt"></i> Refresh Suggestions
    </button>
</div>
        	<button id="clear-btn" title="Clear Prompt"><i class="fas fa-trash"></i> Clear</button>
            <p style="font-size: 12px; color: #777; font-style: italic;"><i class="fas fa-circle-info"></i>
  Tuliskan dalam bahasa Inggris untuk hasil yang akurat
            </p>
<div class="input-group">
    <i class="fas fa-wand-magic-sparkles input-icon"></i>
    <textarea id="prompt-textarea" placeholder="Describe your dream image in detail... (e.g. A cyberpunk cityscape at night with neon lights, 8k ultra detailed, cinematic lighting)"></textarea>
    <button class="expand-btn" id="expand-textarea-btn" title="Expand"><i class="fas fa-expand"></i></button>
    <div class="input-buttons">
        <button id="enhance-btn" title="Enhance Prompt"><i class="fas fa-brain"></i> Enhance</button>
        <button id="generate-btn"><i class="fas fa-magic-wand-sparkles"></i> Generate</button>
    </div>
</div>
                <div class="input-group">
    <!-- Existing input group code -->
</div>

<!-- Add this right after the input group -->
<div class="batch-controls">
    <label for="batch-count"><i class="fas fa-copy"></i> Batch Count</label>
    <div class="batch-input-container">
        <input type="number" id="batch-count" min="1" max="10" value="1">
        <button id="batch-generate-btn" class="btn btn-secondary">
            <i class="fas fa-layer-group"></i> Generate Batch
        </button>
    </div>
    <div class="note">Generate multiple variations at once (max 10)</div>
</div>
            </div>
            
            <div class="settings-grid">
                <div class="setting-group">
                    <label><i class="fas fa-expand"></i> Image Dimensions</label>
                    <div class="slider-container">
                        <div class="dimension-slider-container">
                            <span>Width:</span>
                            <input type="range" class="dimension-slider" id="width-slider" min="512" max="2048" value="1024" step="64">
                            <span class="dimension-value" id="width-value">1024</span>
                        </div>
                        <div class="dimension-slider-container">
                            <span>Height:</span>
                            <input type="range" class="dimension-slider" id="height-slider" min="512" max="2048" value="1792" step="64">
                            <span class="dimension-value" id="height-value">1792</span>
                        </div>
                        <div class="aspect-ratio-display" id="aspect-ratio-display">Aspect Ratio: 1:1</div>
                                            <div style="margin-top:15px; font-size:0.8em;text-align:center" class="advanced-toggle" id="model-notes-toggle">
    <span><i class="fas fa-info-circle"></i>  Model Notes for dimensions</span>
    <i class="fas fa-chevron-down" id="model-notes-arrow"></i>
</div>

<div class="advanced-content" id="model-notes-content">
    <div class="note"><span style="color:red">DALL-E 3</span> only supports the following sizes: 1024×1024, 1792×1024, or 1024×1792</div>
    <div class="note"><span style="color:red">Stability.AI</span> requires both width and height to be multiples of 64 (e.g., 512, 576, 640, 704, 768)</div>
    <div class="note">This requirement is due to the architecture of the model, which uses layered downsampling and upsampling operations that work best with sizes divisible by 64</div>
    <div class="note">Optimal image size range: 512–2048 pixels (for both width and height)</div>
    <div class="note">Recommended sizes: 512×512, 768×768, 1024×1024, 1024×1536 — depending on your hardware capability</div>
    <div class="note">Avoid non-multiples of 64 like 500×600 or 1023×1023, as they may cause errors or degraded performance</div>
</div>
                    </div>
                </div>
                
                <div class="setting-group">
                    <label for="model"><i class="fas fa-microchip"></i> AI Model</label>
                    <div class="select-container">
                        <i class="fas fa-microchip"></i>
                        <select id="model">
                            <option value="pollinations">FLUX Turbo</option>
                            <option value="dall-e-3">DALL-E 3 (Requires API Key)</option>
                            <option value="stability-ai">Stability.AI (Requires API Key)</option>
                        </select>
                    </div>
                <div class="setting-group">
                    <label for="style"><i class="fas fa-paint-brush"></i> Art Style</label>
                    <div class="select-container">
                        <i class="fas fa-paint-brush"></i>
                        <select id="style">
                            <!-- Ultra Realism -->
                            <optgroup label="Ultra Realism">
                                <option value="">Hyper Realistic</option>
                                <option value="photorealistic">8K Photorealistic</option>
                                <option value="cinematic realism">Cinematic Realism</option>
                                <option value="hyperdetailed">Hyperdetailed</option>
                                <option value="sci-fi realism">Sci-Fi Realism</option>
                                <option value="medical illustration">Medical Illustration</option>
                            </optgroup>

                            <!-- Photography -->
                            <optgroup label="Photography Styles">
                                <option value="professional photography">Professional Photography</option>
                                <option value="casual photography">Casual Photography</option>
                                <option value="studio portrait">Studio Portrait (Ring Light)</option>
                                <option value="fujifilm pro">Fujifilm PRO</option>
                                <option value="kodak portra">Kodak Portra</option>
                                <option value="leica m">Leica M-Series</option>
                                
                                <!-- Sub-genres -->
                                <option value="street photography">Street Photography</option>
                                <option value="urban exploration">Urban Exploration</option>
                                <option value="fashion photography">Fashion Editorial</option>
                                <option value="product photography">Product Photography</option>
                                <option value="food photography">Food Photography</option>
                                <option value="macro photography">Macro Photography</option>
                                <option value="astrophotography">Astrophotography</option>
                                <option value="underwater">Underwater Photography</option>
                                <option value="drone photography">Drone Photography</option>
                                <option value="long exposure">Long Exposure</option>
                                <option value="tilt-shift">Tilt-Shift</option>
                                <option value="infrared">Infrared Photography</option>
                            </optgroup>

                            <!-- Anime/Manga -->
                            <optgroup label="Anime & Manga">
                                <option value="anime">Modern Anime</option>
                                <option value="studio ghibli">Studio Ghibli</option>
                                <option value="makoto shinkai">Makoto Shinkai</option>
                                <option value="90s anime">90s Anime</option>
                                <option value="manga">Shonen Manga</option>
                                <option value="seinen manga">Seinen Manga</option>
                                <option value="webtoon">Webtoon</option>
                                <option value="manhwa">Korean Manhwa</option>
                                <option value="chibi">Chibi</option>
                                <option value="kawaii">Kawaii Style</option>
                                <option value="mecha anime">Mecha Anime</option>
                                <option value="shoujo anime">Shoujo Anime</option>
                            </optgroup>

                            <!-- Digital Painting -->
                            <optgroup label="Digital Painting">
                                <option value="digital painting">Digital Painting</option>
                                <option value="concept art">Concept Art</option>
                                <option value="character design">Character Design</option>
                                <option value="environment art">Environment Art</option>
                                <option value="matte painting">Matte Painting</option>
                                <option value="speedpainting">Speedpainting</option>
                                <option value="fantasy art">Fantasy Art</option>
                                <option value="dark fantasy">Dark Fantasy</option>
                                <option value="book illustration">Book Illustration</option>
                                <option value="children book">Children's Book</option>
                            </optgroup>

                            <!-- Traditional Media -->
                            <optgroup label="Traditional Media">
                                <option value="oil painting">Oil Painting</option>
                                <option value="watercolor">Watercolor</option>
                                <option value="gouache">Gouache</option>
                                <option value="acrylic painting">Acrylic Painting</option>
                                <option value="pastel">Pastel</option>
                                <option value="ink wash">Ink Wash</option>
                                <option value="fresco">Fresco</option>
                                <option value="tempera">Tempera</option>
                                
                                <!-- Historical Periods -->
                                <option value="renaissance">Renaissance</option>
                                <option value="baroque">Baroque</option>
                                <option value="rococo">Rococo</option>
                                <option value="impressionist">Impressionist</option>
                                <option value="post-impressionist">Post-Impressionist</option>
                                <option value="expressionist">Expressionist</option>
                                <option value="art nouveau">Art Nouveau</option>
                                <option value="art deco">Art Deco</option>
                                <option value="victorian">Victorian</option>
                                <option value="socialist realism">Socialist Realism</option>
                            </optgroup>

                            <!-- Drawing Techniques -->
                            <optgroup label="Drawing Techniques">
                                <option value="pencil sketch">Pencil Sketch</option>
                                <option value="charcoal sketch">Charcoal Sketch</option>
                                <option value="ink drawing">Ink Drawing</option>
                                <option value="ballpoint pen">Ballpoint Pen</option>
                                <option value="colored pencil">Colored Pencil</option>
                                <option value="marker drawing">Marker Drawing</option>
                                <option value="etching">Etching</option>
                                <option value="linocut">Linocut</option>
                                <option value="woodcut">Woodcut</option>
                                <option value="pointillism">Pointillism</option>
                                <option value="stippling">Stippling</option>
                            </optgroup>

                            <!-- 3D & CGI -->
                            <optgroup label="3D & CGI">
                                <option value="3d render">3D Render</option>
                                <option value="blender">Blender</option>
                                <option value="unreal engine">Unreal Engine</option>
                                <option value="octane render">Octane Render</option>
                                <option value="redshift">Redshift</option>
                                <option value="arnold render">Arnold Render</option>
                                <option value="zbrush">ZBrush Sculpt</option>
                                <option value="claymation">Claymation</option>
                                <option value="stop motion">Stop Motion</option>
                                <option value="isometric">Isometric</option>
                                <option value="voxel art">Voxel Art</option>
                            </optgroup>

                            <!-- Game Art Styles -->
                            <optgroup label="Game Art Styles">
                                <option value="low poly">Low Poly</option>
                                <option value="pixel art">Pixel Art</option>
                                <option value="ps1 graphics">PS1 Graphics</option>
                                <option value="ps2 graphics">PS2 Graphics</option>
                                <option value="n64 style">N64 Style</option>
                                <option value="arc system works">Arc System Works</option>
                                <option value="cel shaded">Cel-Shaded</option>
                                <option value="borderlands">Borderlands Style</option>
                                <option value="valorant style">Valorant Style</option>
                                <option value="overwatch style">Overwatch Style</option>
                                <option value="genshin impact">Genshin Impact</option>
                                <option value="honkai star rail">Honkai: Star Rail</option>
                            </optgroup>

                            <!-- Cyberpunk & Futuristic -->
                            <optgroup label="Cyberpunk & Futuristic">
                                <option value="cyberpunk">Cyberpunk 2077</option>
                                <option value="cyberpunk anime">Cyberpunk Anime</option>
                                <option value="biopunk">Biopunk</option>
                                <option value="dieselpunk">Dieselpunk</option>
                                <option value="steampunk">Steampunk</option>
                                <option value="atompunk">Atompunk</option>
                                <option value="solarpunk">Solarpunk</option>
                                <option value="cassette futurism">Cassette Futurism</option>
                                <option value="retro futurism">Retro Futurism</option>
                                <option value="blade runner">Blade Runner</option>
                                <option value="ghost in the shell">Ghost in the Shell</option>
                            </optgroup>

                            <!-- Cartoon & Comics -->
                            <optgroup label="Cartoon & Comics">
                                <option value="disney style">Disney</option>
                                <option value="pixar style">Pixar</option>
                                <option value="dreamworks">Dreamworks</option>
                                <option value="cartoon network">Cartoon Network</option>
                                <option value="adult swim">Adult Swim</option>
                                <option value="rick and morty">Rick and Morty</option>
                                <option value="calarts style">CalArts Style</option>
                                <option value="peanuts">Peanuts</option>
                                <option value="marvel comics">Marvel Comics</option>
                                <option value="dc comics">DC Comics</option>
                                <option value="european comics">European Comics</option>
                                <option value="french ligne claire">Ligne Claire</option>
                            </optgroup>

                            <!-- Abstract & Experimental -->
                            <optgroup label="Abstract & Experimental">
                                <option value="abstract">Abstract</option>
                                <option value="cubism">Cubism</option>
                                <option value="surrealism">Surrealism</option>
                                <option value="dadaism">Dadaism</option>
                                <option value="bauhaus">Bauhaus</option>
                                <option value="constructivism">Constructivism</option>
                                <option value="psychedelic">Psychedelic</option>
                                <option value="fluid art">Fluid Art</option>
                                <option value="glitch art">Glitch Art</option>
                                <option value="fractal art">Fractal Art</option>
                                <option value="generative art">Generative Art</option>
                                <option value="data bending">Data Bending</option>
                            </optgroup>

                            <!-- Special Effects -->
                            <optgroup label="Special Effects">
                                <option value="holographic">Holographic</option>
                                <option value="neon glow">Neon Glow</option>
                                <option value="chromatic aberration">Chromatic Aberration</option>
                                <option value="double exposure">Double Exposure</option>
                                <option value="light painting">Light Painting</option>
                                <option value="lens flare">Lens Flare</option>
                                <option value="vhs effect">VHS Effect</option>
                                <option value="crt screen">CRT Screen</option>
                                <option value="film grain">Film Grain</option>
                                <option value="cross processing">Cross Processing</option>
                            </optgroup>

                            <!-- Cultural & Historical -->
                            <optgroup label="Cultural & Historical">
                                <option value="ukiyo-e">Ukiyo-e</option>
                                <option value="chinese painting">Chinese Painting</option>
                                <option value="sumi-e">Sumi-e</option>
                                <option value="persian miniature">Persian Miniature</option>
                                <option value="medieval illuminated">Medieval Illuminated</option>
                                <option value="byzantine icon">Byzantine Icon</option>
                                <option value="tribal art">Tribal Art</option>
                                <option value="afrofuturism">Afrofuturism</option>
                                <option value="indigenous art">Indigenous Art</option>
                                <option value="soviet propaganda">Soviet Propaganda</option>
                            </optgroup>
                        </select>
                    </div>
                </div>
                
                <div class="setting-group">
                    <label for="quality"><i class="fas fa-star"></i> Quality</label>
                    <div class="select-container">
                        <i class="fas fa-star"></i>
                        <select id="quality">
                            <option value="normal">Normal</option>
                            <option value="high" selected>High</option>
                            <option value="ultra">Ultra</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="advanced-toggle" id="advanced-toggle">
                <span><i class="fas fa-cogs"></i> Advanced Settings</span>
                <i class="fas fa-chevron-down" id="advanced-arrow"></i>
            </div>
            
            <div class="advanced-content" id="advanced-content">
                <div class="settings-grid">
                    <div class="setting-group">
                        <label for="lighting"><i class="fas fa-lightbulb"></i> Lighting</label>
                        <div class="select-container">
                            <i class="fas fa-lightbulb"></i>
                            <select id="lighting">
                                <option value="">Default</option>
                                <option value="dramatic">Dramatic</option>
                                <option value="soft">Soft</option>
                                <option value="cinematic">Cinematic</option>
                                <option value="neon">Neon</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label for="color"><i class="fas fa-palette"></i> Color Palette</label>
                        <div class="select-container">
                            <i class="fas fa-palette"></i>
                            <select id="color">
                                <option value="">Default</option>
                                <option value="vibrant">Vibrant</option>
                                <option value="pastel">Pastel</option>
                                <option value="monochrome">Monochrome</option>
                                <option value="warm">Warm Tones</option>
                                <option value="cool">Cool Tones</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label for="composition"><i class="fas fa-th-large"></i> Composition</label>
                        <div class="select-container">
                            <i class="fas fa-th-large"></i>
                            <select id="composition">
                                <option value="">Default</option>
                                <option value="close-up">Close-up</option>
                                <option value="wide shot">Wide Shot</option>
                                <option value="macro">Macro</option>
                                <option value="aerial">Aerial</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label for="seed"><i class="fas fa-seedling"></i> Seed (for consistency)</label>
                        <div class="number-input-container">
                            <i class="fas fa-seedling"></i>
                            <input type="number" id="seed" placeholder="Leave blank for random">
                        </div>
                    </div>
                </div>
                
                <div class="checkbox-container">
                    <div class="checkbox-group">
                        <input type="checkbox" id="hd" checked>
                        <label for="hd"><i class="fas fa-expand"></i> HD Resolution</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="safe-filter" checked>
                        <label for="safe-filter"><i class="fas fa-shield-alt"></i> Safe Filter (NSFW protection)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="enhance-details" checked>
                        <label for="enhance-details"><i class="fas fa-search-plus"></i> Enhance Details</label>
                    </div>
                </div>
            </div>
            
            <div class="loading">
                <div class="spinner"></div>
                <p id="loading-text">Kami sedang menyiapkan hasil terbaik untuk Anda... Tunggu sejenak</p>
            </div>
            
            <div class="error-message" id="error-message"></div>
        </div>
        
        <div class="image-container" id="generated-image-container">
            <img id="generated-image" alt="Your AI generated image will appear here">
            <div class="action-buttons">
                <button class="btn btn-primary" id="download-btn"><i class="fas fa-download"></i> <span class="download-text">Download</span></button>
                <button class="btn btn-secondary" id="share-btn"><i class="fas fa-share-alt"></i> <span class="share-text">Share</span></button>
                <button class="btn btn-secondary" id="remix-btn"><i class="fas fa-random"></i> <span class="remix-text">Remix</span></button>
                <button class="btn btn-secondary" id="variation-btn"><i class="fas fa-clone"></i> <span class="variation-text">Variation</span></button>
                <button class="btn btn-secondary" id="save-prompt-btn"><i class="fas fa-bookmark"></i> <span class="save-text">Save Prompt</span></button>
            </div>
        </div>
        
        <div class="card history-panel" id="history-panel">
            <div class="history-header">
                <h3><i class="fas fa-history"></i> <span class="history-text">Generation History</span></h3>
                <button class="btn btn-danger" id="reset-history-btn"><i class="fas fa-trash"></i> <span class="clear-history-text">Clear History</span></button>
            </div>
            <div id="history-list"></div>
        </div>
        
        <div class="card saved-prompts-panel" id="saved-prompts-panel">
            <h3><i class="fas fa-bookmark"></i> <span class="saved-prompts-text">Saved Prompts</span></h3>
            <div id="saved-prompts-list"></div>
        </div>
    </div>
    
    <!-- API Key Modal -->
    <div class="modal" id="api-key-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="api-key-modal-title"><i class="fas fa-key"></i> API Key Required</h3>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="api-key-instructions">To use this model, please enter your API key. Your key will be stored locally in your browser and never sent to our servers.</p>
                <input type="password" class="api-key-input" id="api-key-input" placeholder="Enter your API key">
                <p class="text-muted" id="api-key-link"><small>Don't have an API key? Get one from <a href="#" target="_blank" id="api-key-provider-link">the provider</a></small></p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="cancel-btn">Cancel</button>
                <button class="modal-btn modal-btn-primary" id="save-api-key-btn">Save API Key</button>
            </div>
        </div>
    </div>
    <!-- Textarea Expansion Modal -->
<div class="modal" id="textarea-modal">
    <div class="modal-content" style="max-width: 100%; height: 100%; display: flex; flex-direction: column;">
        <div class="modal-header">
            <h3 class="modal-title"><i class="fas fa-edit"></i> Write Your Prompt</h3>
            <button class="close-modal" id="close-textarea-modal">&times;</button>
        </div>
        <div class="modal-body" style="flex: 1; padding: 0;">
            <textarea id="fullscreen-textarea" style="width: 100%; height: 100%; border: none; padding: 20px; resize: none;"></textarea>
        </div>
        <div class="modal-footer" style="justify-content: center;">
            <button class="modal-btn modal-btn-primary" id="save-textarea-btn">Done</button>
        </div>
    </div>
</div>
<footer>
    &copy; <span id="current-year"></span> RuangRiung AI Image Generator Ver.4.1.3. All rights reserved | 
    powered by <a href="https://pollinations.ai" target="_blank" class="footer-link">Pollinations.ai</a> | 
    Develop with ♥️ by <a href="https://ariftirtana.my.id" target="_blank" class="footer-link">Arif Tirtana</a> | Thanks to <i class="fab fa-github"></i><a href="https://github.com" target="_blank" class="footer-link"> GitHub</a> &  <a href="https://www.cloudflare.com/" target="_blank" class="footer-link">Cloudflare</a> <i class="fas fa-cloud"></i>
<button id="reset-all-btn" class="footer-reset-btn"><i class="fas fa-trash"></i> <span class="reset-all-text">Reset All Settings</span></button>
<!-- Histats.com  (div with counter) --><div id="histats_counter"></div>
<!-- Histats.com  START  (aync)-->
<script type="text/javascript">var _Hasync= _Hasync|| [];
_Hasync.push(['Histats.start', '1,4944741,4,4012,112,61,00011111']);
_Hasync.push(['Histats.fasi', '1']);
_Hasync.push(['Histats.track_hits', '']);
(function() {
var hs = document.createElement('script'); hs.type = 'text/javascript'; hs.async = true;
hs.src = ('//s10.histats.com/js15_as.js');
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(hs);
})();</script>
<noscript><a href="/" target="_blank"><img  src="//sstatic1.histats.com/0.gif?4944741&101" alt="" border="0"></a></noscript>
<!-- Histats.com  END  -->
</footer>
<a href="https://www.facebook.com/groups/1182261482811767/?ref=share&mibextid=lOuIew" target="_blank" class="floating-facebook-btn" title="Follow us on Facebook">
    <i class="fab fa-facebook-f"></i>
</a>
    <script>
// Language translations
const translations = {
    en: {
        title: "RuangRiung AI Image Generator",
        subtitle: "Transform your imagination into stunning visuals with AI",
        darkMode: "Dark Mode",
        lightMode: "Light Mode",
        promptPlaceholder: "Describe your dream image in detail... (e.g. A cyberpunk cityscape at night with neon lights, 8k ultra detailed, cinematic lighting)",
        enhanceBtn: "Enhance",
        generateBtn: "Generate",
        batchCount: "Batch Count",
        batchGenerate: "Generate Batch",
        batchNote: "Generate multiple variations at once (max 10)",
        imageDimensions: "Image Dimensions",
        width: "Width:",
        height: "Height:",
        aspectRatio: "Aspect Ratio:",
        modelNotes: "Model Notes for dimensions",
        aiModel: "AI Model",
        artStyle: "Art Style",
        quality: "Quality",
        advancedSettings: "Advanced Settings",
        lighting: "Lighting",
        colorPalette: "Color Palette",
        composition: "Composition",
        seed: "Seed (for consistency)",
        hd: "HD Resolution",
        safeFilter: "Safe Filter (NSFW protection)",
        enhanceDetails: "Enhance Details",
        loadingText: "Preparing the best results for you... Please wait",
        download: "Download",
        share: "Share",
        remix: "Remix",
        variation: "Variation",
        savePrompt: "Save Prompt",
        history: "Generation History",
        clearHistory: "Clear History",
        savedPrompts: "Saved Prompts",
        resetAll: "Reset All Settings",
        englishNote: "Write in English for accurate results",
        clear: "Clear",
        modelNotesContent: [
            "<span style='color:red'>DALL-E 3</span> only supports the following sizes: 1024×1024, 1792×1024, or 1024×1792",
            "<span style='color:red'>Stability.AI</span> requires both width and height to be multiples of 64 (e.g., 512, 576, 640, 704, 768)",
            "This requirement is due to the architecture of the model, which uses layered downsampling and upsampling operations that work best with sizes divisible by 64",
            "Optimal image size range: 512–2048 pixels (for both width and height)",
            "Recommended sizes: 512×512, 768×768, 1024×1024, 1024×1536 — depending on your hardware capability",
            "Avoid non-multiples of 64 like 500×600 or 1023×1023, as they may cause errors or degraded performance"
        ]
    },
    id: {
        title: "RuangRiung Generator Gambar AI",
        subtitle: "Ubah imajinasi Anda menjadi visual menakjubkan dengan AI",
        darkMode: "Mode Gelap",
        lightMode: "Mode Terang",
        promptPlaceholder: "Jelaskan gambar impian Anda secara detail... (contoh: Pemandangan kota cyberpunk di malam hari dengan lampu neon, detail ultra 8k, pencahayaan sinematik)",
        enhanceBtn: "Tingkatkan",
        generateBtn: "Hasilkan",
        batchCount: "Jumlah Batch",
        batchGenerate: "Hasilkan Batch",
        batchNote: "Hasilkan beberapa variasi sekaligus (maks 10)",
        imageDimensions: "Dimensi Gambar",
        width: "Lebar:",
        height: "Tinggi:",
        aspectRatio: "Rasio Aspek:",
        modelNotes: "Catatan Model untuk dimensi",
        aiModel: "Model AI",
        artStyle: "Gaya Seni",
        quality: "Kualitas",
        advancedSettings: "Pengaturan Lanjutan",
        lighting: "Pencahayaan",
        colorPalette: "Palet Warna",
        composition: "Komposisi",
        seed: "Seed (untuk konsistensi)",
        hd: "Resolusi HD",
        safeFilter: "Filter Aman (perlindungan NSFW)",
        enhanceDetails: "Tingkatkan Detail",
        loadingText: "Mempersiapkan hasil terbaik untuk Anda... Mohon tunggu",
        download: "Unduh",
        share: "Bagikan",
        remix: "Remix",
        variation: "Variasi",
        savePrompt: "Simpan Prompt",
        history: "Riwayat Generasi",
        clearHistory: "Hapus Riwayat",
        savedPrompts: "Prompt Tersimpan",
        resetAll: "Atur Ulang Semua Pengaturan",
        englishNote: "Tulis dalam bahasa Inggris untuk hasil yang akurat",
        clear: "Hapus",
        modelNotesContent: [
            "<span style='color:red'>DALL-E 3</span> hanya mendukung ukuran berikut: 1024×1024, 1792×1024, atau 1024×1792",
            "<span style='color:red'>Stability.AI</span> membutuhkan lebar dan tinggi yang merupakan kelipatan 64 (misalnya, 512, 576, 640, 704, 768)",
            "Persyaratan ini disebabkan oleh arsitektur model yang menggunakan operasi downsampling dan upsampling berlapis yang bekerja paling baik dengan ukuran yang dapat dibagi 64",
            "Rentang ukuran gambar optimal: 512–2048 piksel (untuk lebar dan tinggi)",
            "Ukuran yang direkomendasikan: 512×512, 768×768, 1024×1024, 1024×1536 — tergantung kemampuan perangkat keras Anda",
            "Hindari kelipatan non-64 seperti 500×600 atau 1023×1023, karena dapat menyebabkan kesalahan atau penurunan performa"
        ]
    }
};

document.addEventListener('DOMContentLoaded', function() {
    // Set current year in footer
    document.getElementById('current-year').textContent = new Date().getFullYear();
    
    // Elements
    const promptTextarea = document.getElementById('prompt-textarea');
    const generateBtn = document.getElementById('generate-btn');
    const enhanceBtn = document.getElementById('enhance-btn');
    const generatedImage = document.getElementById('generated-image');
    const loadingElement = document.querySelector('.loading');
    const downloadBtn = document.getElementById('download-btn');
    const shareBtn = document.getElementById('share-btn');
    const remixBtn = document.getElementById('remix-btn');
    const variationBtn = document.getElementById('variation-btn');
    const savePromptBtn = document.getElementById('save-prompt-btn');
    const errorMessage = document.getElementById('error-message');
    const historyPanel = document.getElementById('history-panel');
    const historyList = document.getElementById('history-list');
    const resetHistoryBtn = document.getElementById('reset-history-btn');
    const savedPromptsPanel = document.getElementById('saved-prompts-panel');
    const savedPromptsList = document.getElementById('saved-prompts-list');
    const advancedToggle = document.getElementById('advanced-toggle');
    const advancedContent = document.getElementById('advanced-content');
    const advancedArrow = document.getElementById('advanced-arrow');
    const darkModeToggle = document.getElementById('dark-mode-toggle');
    const widthSlider = document.getElementById('width-slider');
    const heightSlider = document.getElementById('height-slider');
    const widthValue = document.getElementById('width-value');
    const heightValue = document.getElementById('height-value');
    const aspectRatioDisplay = document.getElementById('aspect-ratio-display');
    const modelSelect = document.getElementById('model');
    const clearBtn = document.getElementById('clear-btn');
    const batchCountInput = document.getElementById('batch-count');
    const batchGenerateBtn = document.getElementById('batch-generate-btn');
    const modelNotesToggle = document.getElementById('model-notes-toggle');
    const modelNotesContent = document.getElementById('model-notes-content');
    const modelNotesArrow = document.getElementById('model-notes-arrow');
    const promptSuggestionsContainer = document.getElementById('prompt-suggestions');
    const suggestionsLoading = document.getElementById('suggestions-loading');
    const refreshSuggestionsBtn = document.getElementById('refresh-suggestions');
    const loadingText = document.getElementById('loading-text');
    const englishNote = document.querySelector('.note');
    const languageToggle = document.getElementById('language-toggle');
    const langEn = document.getElementById('lang-en');
    const langId = document.getElementById('lang-id');

    // Modal elements
    const apiKeyModal = document.getElementById('api-key-modal');
    const apiKeyModalTitle = document.getElementById('api-key-modal-title');
    const apiKeyInstructions = document.getElementById('api-key-instructions');
    const apiKeyInput = document.getElementById('api-key-input');
    const apiKeyLink = document.getElementById('api-key-link');
    const apiKeyProviderLink = document.getElementById('api-key-provider-link');
    const closeModalBtn = document.getElementById('close-modal');
    const cancelBtn = document.getElementById('cancel-btn');
    const saveApiKeyBtn = document.getElementById('save-api-key-btn');

    // Settings elements
    const styleSelect = document.getElementById('style');
    const qualitySelect = document.getElementById('quality');
    const lightingSelect = document.getElementById('lighting');
    const colorSelect = document.getElementById('color');
    const compositionSelect = document.getElementById('composition');
    const seedInput = document.getElementById('seed');
    const hdCheckbox = document.getElementById('hd');
    const enhanceDetailsCheckbox = document.getElementById('enhance-details');
    const safeFilterCheckbox = document.getElementById('safe-filter');
    // Add these to your existing elements list
const expandTextareaBtn = document.getElementById('expand-textarea-btn');
const textareaModal = document.getElementById('textarea-modal');
const fullscreenTextarea = document.getElementById('fullscreen-textarea');
const closeTextareaModal = document.getElementById('close-textarea-modal');
const saveTextareaBtn = document.getElementById('save-textarea-btn');

// Event listeners for textarea expansion
expandTextareaBtn.addEventListener('click', function() {
    fullscreenTextarea.value = promptTextarea.value;
    textareaModal.style.display = 'flex';
    fullscreenTextarea.focus();
});

closeTextareaModal.addEventListener('click', function() {
    promptTextarea.value = fullscreenTextarea.value;
    textareaModal.style.display = 'none';
});

saveTextareaBtn.addEventListener('click', function() {
    promptTextarea.value = fullscreenTextarea.value;
    textareaModal.style.display = 'none';
});

// Close modal when clicking outside
textareaModal.addEventListener('click', function(e) {
    if (e.target === textareaModal) {
        promptTextarea.value = fullscreenTextarea.value;
        textareaModal.style.display = 'none';
    }
});

// Handle Enter key in fullscreen textarea
fullscreenTextarea.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        promptTextarea.value = fullscreenTextarea.value;
        textareaModal.style.display = 'none';
        generateImage();
    }
});

    // History array
    let generationHistory = JSON.parse(localStorage.getItem('generationHistory')) || [];
    let savedPrompts = JSON.parse(localStorage.getItem('savedPrompts')) || [];
    
    // Current generation state
    let currentGeneration = {
        prompt: '',
        seed: null,
        model: '',
        settings: {}
    };
    
    // Default prompts in case AI generation fails
    const defaultPrompts = [
        "A majestic lion in the savannah at sunset, ultra detailed, cinematic lighting, 8k",
        "Cyberpunk cityscape at night with neon lights, rain-soaked streets, futuristic vehicles, 8k ultra detailed",
        "Portrait of a beautiful elf with intricate jewelry, fantasy art, highly detailed, digital painting",
        "Cute anime girl with pink hair in a cherry blossom garden, Studio Ghibli style",
        "Futuristic spaceship orbiting a gas giant, sci-fi, hyperrealistic, 8k"
    ];
    
    // Check for saved dark mode preference
    const darkMode = localStorage.getItem('darkMode') === 'true';
    if (darkMode) {
        document.body.classList.add('dark-mode');
        darkModeToggle.innerHTML = '<i class="fas fa-sun"></i><span>Light Mode</span>';
    }
    
    // Check for saved language preference
    let currentLanguage = localStorage.getItem('language') || 'en';
    updateLanguage(currentLanguage);
    
    // Check for saved API keys
    const savedDalleApiKey = localStorage.getItem('dalleApiKey');
    const savedStabilityApiKey = localStorage.getItem('stabilityApiKey');
    
    // Initialize
    updateHistoryPanel();
    updateSavedPromptsPanel();
    updateSliderFill();
    updateDimensionSliders();
    generatePromptSuggestions(); // Generate prompt suggestions on load
    
    // Event listeners
    generateBtn.addEventListener('click', generateImage);
    enhanceBtn.addEventListener('click', enhancePrompt);
    promptTextarea.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            generateImage();
        }
    });
    
    downloadBtn.addEventListener('click', downloadImage);
    shareBtn.addEventListener('click', shareImage);
    remixBtn.addEventListener('click', remixImage);
    variationBtn.addEventListener('click', generateVariation);
    savePromptBtn.addEventListener('click', savePrompt);
    advancedToggle.addEventListener('click', toggleAdvanced);
    darkModeToggle.addEventListener('click', toggleDarkMode);
    widthSlider.addEventListener('input', updateDimensionSliders);
    heightSlider.addEventListener('input', updateDimensionSliders);
    resetHistoryBtn.addEventListener('click', resetHistory);
    clearBtn.addEventListener('click', clearPrompt);
    batchGenerateBtn.addEventListener('click', generateBatch);
    modelNotesToggle.addEventListener('click', toggleModelNotes);
    modelSelect.addEventListener('change', handleModelChange);
    refreshSuggestionsBtn.addEventListener('click', generatePromptSuggestions);
    
    // Language toggle event listeners
    langEn.addEventListener('click', function() {
        if (currentLanguage !== 'en') {
            currentLanguage = 'en';
            localStorage.setItem('language', 'en');
            updateLanguage('en');
        }
    });
    
    langId.addEventListener('click', function() {
        if (currentLanguage !== 'id') {
            currentLanguage = 'id';
            localStorage.setItem('language', 'id');
            updateLanguage('id');
        }
    });
    
    // Modal event listeners
    closeModalBtn.addEventListener('click', closeModal);
    cancelBtn.addEventListener('click', closeModal);
    saveApiKeyBtn.addEventListener('click', saveApiKey);
    
    // Update slider fill for dimension sliders
    widthSlider.addEventListener('input', updateSliderFill);
    heightSlider.addEventListener('input', updateSliderFill);
    
    // Reset all settings button
    document.getElementById('reset-all-btn').addEventListener('click', resetAllSettings);

    // Function to update language
    function updateLanguage(lang) {
        const t = translations[lang];
        
        // Update UI elements
        document.querySelector('h1').innerHTML = `<i class="fas fa-magic-wand-sparkles"></i> ${t.title}`;
        document.querySelector('.subtitle').textContent = t.subtitle;
        darkModeToggle.querySelector('span').textContent = darkMode ? t.lightMode : t.darkMode;
        promptTextarea.placeholder = t.promptPlaceholder;
        enhanceBtn.innerHTML = `<i class="fas fa-brain"></i> ${t.enhanceBtn}`;
        generateBtn.innerHTML = `<i class="fas fa-magic-wand-sparkles"></i> ${t.generateBtn}`;
        document.querySelector('label[for="batch-count"]').innerHTML = `<i class="fas fa-copy"></i> ${t.batchCount}`;
        batchGenerateBtn.innerHTML = `<i class="fas fa-layer-group"></i> ${t.batchGenerate}`;
        document.querySelector('.batch-controls .note').textContent = t.batchNote;
        document.querySelector('label[for="model"]').innerHTML = `<i class="fas fa-microchip"></i> ${t.aiModel}`;
        document.querySelector('label[for="style"]').innerHTML = `<i class="fas fa-paint-brush"></i> ${t.artStyle}`;
        document.querySelector('label[for="quality"]').innerHTML = `<i class="fas fa-star"></i> ${t.quality}`;
        advancedToggle.querySelector('span').innerHTML = `<i class="fas fa-cogs"></i> ${t.advancedSettings}`;
        document.querySelector('label[for="lighting"]').innerHTML = `<i class="fas fa-lightbulb"></i> ${t.lighting}`;
        document.querySelector('label[for="color"]').innerHTML = `<i class="fas fa-palette"></i> ${t.colorPalette}`;
        document.querySelector('label[for="composition"]').innerHTML = `<i class="fas fa-th-large"></i> ${t.composition}`;
        document.querySelector('label[for="seed"]').innerHTML = `<i class="fas fa-seedling"></i> ${t.seed}`;
        document.querySelector('label[for="hd"]').innerHTML = `<i class="fas fa-expand"></i> ${t.hd}`;
        document.querySelector('label[for="safe-filter"]').innerHTML = `<i class="fas fa-shield-alt"></i> ${t.safeFilter}`;
        document.querySelector('label[for="enhance-details"]').innerHTML = `<i class="fas fa-search-plus"></i> ${t.enhanceDetails}`;
        loadingText.textContent = t.loadingText;
        document.querySelector('.download-text').textContent = t.download;
        document.querySelector('.share-text').textContent = t.share;
        document.querySelector('.remix-text').textContent = t.remix;
        document.querySelector('.variation-text').textContent = t.variation;
        document.querySelector('.save-text').textContent = t.savePrompt;
        document.querySelector('.history-text').textContent = t.history;
        document.querySelector('.clear-history-text').textContent = t.clearHistory;
        document.querySelector('.saved-prompts-text').textContent = t.savedPrompts;
        document.querySelector('.reset-all-text').textContent = t.resetAll;
        document.querySelector('.note').innerHTML = `<i class="fas fa-circle-info"></i> ${t.englishNote}`;
        clearBtn.innerHTML = `<i class="fas fa-trash"></i> ${t.clear}`;
        modelNotesToggle.querySelector('span').innerHTML = `<i class="fas fa-info-circle"></i> ${t.modelNotes}`;
        
        // Update model notes content
        const notesContent = modelNotesContent.querySelectorAll('.note');
        t.modelNotesContent.forEach((note, index) => {
            if (notesContent[index]) {
                notesContent[index].innerHTML = note;
            }
        });
        
        // Update language toggle active state
        if (lang === 'en') {
            langEn.classList.add('active');
            langId.classList.remove('active');
        } else {
            langEn.classList.remove('active');
            langId.classList.add('active');
        }
    }

    // Function to generate AI-powered prompt suggestions
    async function generatePromptSuggestions() {
        promptSuggestionsContainer.innerHTML = '';
        suggestionsLoading.style.display = 'flex';
        
        try {
            // System message to guide the AI
            const systemMessage = {
                role: "system",
                content: "You are a creative AI prompt generator. Generate 3 diverse, creative, and detailed prompts for AI image generation. " +
                         "Each prompt should be for a different category (fantasy, sci-fi, realism, surealism, anime, ghibli etc). " +
                         "Format the response with each prompt on a new line, prefixed with '1. ', '2. ', etc. " +
                         "Each prompt should be 1-2 sentences long and include details about style, lighting, shot and composition."
            };
            
            let fullResponse = "";
            
            // Call the streaming API
            await streamChatCompletion(
                [systemMessage],
                { 
                    model: "openai",
                    seed: Math.floor(Math.random() * 1000000)
                },
                (textChunk) => {
                    fullResponse += textChunk;
                }
            );
            
            // Process the response to extract prompts
            const prompts = fullResponse.split('\n')
                .map(line => line.replace(/^\d+\.\s*/, '').trim())
                .filter(line => line.length > 0)
                .slice(0, 5); // Take up to 5 prompts
            
            // Display the prompts as clickable buttons
            displayPromptSuggestions(prompts);
            
        } catch (error) {
            console.error('Error generating prompt suggestions:', error);
            // Fallback to default prompts if AI fails
            displayPromptSuggestions(defaultPrompts);
        } finally {
            suggestionsLoading.style.display = 'none';
        }
    }
    
    // Function to display prompt suggestions
    function displayPromptSuggestions(prompts) {
        promptSuggestionsContainer.innerHTML = '';
        
        prompts.forEach((prompt, index) => {
            const button = document.createElement('button');
            button.className = 'prompt-suggestion';
            button.innerHTML = `<i class="fas fa-lightbulb"></i> ${currentLanguage === 'en' ? 'Suggestion' : 'Saran'} ${index + 1}`;
            button.setAttribute('data-prompt', prompt);
            
            button.addEventListener('click', function() {
                promptTextarea.value = prompt;
                promptTextarea.focus();
            });
            
            promptSuggestionsContainer.appendChild(button);
        });
    }

    // Stream chat completion function for prompt suggestions
    async function streamChatCompletion(messages, options = {}, onChunkReceived) {
        const url = "https://text.pollinations.ai/openai";
        const payload = {
            model: options.model || "openai",
            messages: messages,
            seed: options.seed,
            stream: true,
        };

        try {
            const response = await fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "text/event-stream",
                },
                body: JSON.stringify(payload),
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(
                    `HTTP error! status: ${response.status}, message: ${errorText}`
                );
            }

            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let buffer = "";

            while (true) {
                const { done, value } = await reader.read();
                if (done) break;

                buffer += decoder.decode(value, { stream: true });

                // Process buffer line by line (SSE format: data: {...}\n\n)
                const lines = buffer.split("\n\n");
                buffer = lines.pop(); // Keep the potentially incomplete last line

                for (const line of lines) {
                    if (line.startsWith("data: ")) {
                        const dataStr = line.substring(6).trim();
                        if (dataStr === "[DONE]") continue;
                        
                        try {
                            const chunk = JSON.parse(dataStr);
                            const content = chunk?.choices?.[0]?.delta?.content;
                            if (content && onChunkReceived) {
                                onChunkReceived(content);
                            }
                        } catch (e) {
                            console.error("Failed to parse stream chunk:", dataStr, e);
                        }
                    }
                }
            }
        } catch (error) {
            console.error("Error during streaming chat completion:", error);
            throw error;
        }
    }

    function updateDimensionSliders() {
        const width = parseInt(widthSlider.value);
        const height = parseInt(heightSlider.value);
        
        widthValue.textContent = width;
        heightValue.textContent = height;
        
        // Calculate aspect ratio
        const gcd = (a, b) => b ? gcd(b, a % b) : a;
        const ratio = gcd(width, height);
        const aspectRatio = `${width/ratio}:${height/ratio}`;
        
        aspectRatioDisplay.textContent = `${translations[currentLanguage].aspectRatio} ${aspectRatio}`;
        
        // Update slider fill
        updateSliderFill();
    }
    
    async function generateImage() {
        const prompt = promptTextarea.value.trim();
        const selectedModel = modelSelect.value;
        
        if (!prompt) {
            showError(currentLanguage === 'en' ? 'Please enter a description for the image' : 'Silakan masukkan deskripsi untuk gambar');
            return;
        }
        
        // Check if API key is required and exists
        if (selectedModel === 'dall-e-3') {
            const apiKey = localStorage.getItem('dalleApiKey');
            if (!apiKey) {
                showError(currentLanguage === 'en' ? 'Please provide an API key for DALL-E 3' : 'Harap berikan kunci API untuk DALL-E 3');
                showApiKeyModal('DALL-E 3', 'sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 'https://platform.openai.com/api-keys');
                resetModelToDefault();
                return;
            }
        } else if (selectedModel === 'stability-ai') {
            const apiKey = localStorage.getItem('stabilityApiKey');
            if (!apiKey) {
                showError(currentLanguage === 'en' ? 'Please provide an API key for Stability.AI' : 'Harap berikan kunci API untuk Stability.AI');
                showApiKeyModal('Stability.AI', 'sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 'https://platform.stability.ai/account/keys');
                resetModelToDefault();
                return;
            }
        }
        
        // Scroll to image container before generation starts
        scrollToImageContainer();
        
        // Hide previous image and error, show loading
        generatedImage.style.display = 'none';
        document.querySelectorAll('.btn').forEach(btn => btn.style.display = 'none');
        errorMessage.style.display = 'none';
        loadingElement.style.display = 'block';
        
        // Build the prompt with additional parameters
        let fullPrompt = buildFullPrompt(prompt);
        
        // Store current generation state
        currentGeneration = {
            prompt: fullPrompt,
            seed: seedInput.value || Math.floor(Math.random() * 1000000),
            model: selectedModel,
            settings: {
                width: widthSlider.value,
                height: heightSlider.value,
                style: styleSelect.value,
                quality: qualitySelect.value,
                lighting: lightingSelect.value,
                color: colorSelect.value,
                composition: compositionSelect.value,
                hd: hdCheckbox.checked,
                enhanceDetails: enhanceDetailsCheckbox.checked,
                safeFilter: safeFilterCheckbox.checked
            }
        };
        
        try {
            let imageUrl;
            
            if (selectedModel === 'dall-e-3') {
                imageUrl = await generateWithDalle(fullPrompt);
            } else if (selectedModel === 'stability-ai') {
                imageUrl = await generateWithStability(fullPrompt);
            } else {
                imageUrl = generateWithPollinations(fullPrompt);
            }
            
            // Load the image
            generatedImage.onload = function() {
                loadingElement.style.display = 'none';
                generatedImage.style.display = 'block';
                document.querySelectorAll('.btn').forEach(btn => btn.style.display = 'flex');
                
                // Scroll to image container again after image loads
                scrollToImageContainer();
                
                // Add to history only if this is a new generation, not from history click
                if (!generatedImage.dataset.fromHistory) {
                    addToHistory(fullPrompt, imageUrl);
                } else {
                    delete generatedImage.dataset.fromHistory;
                }
            };
            
            generatedImage.onerror = function() {
                loadingElement.style.display = 'none';
                showError(currentLanguage === 'en' ? 'Failed to generate image. Please try a different prompt.' : 'Gagal menghasilkan gambar. Silakan coba dengan deskripsi yang berbeda.');
            };
            
            generatedImage.src = imageUrl;
        } catch (error) {
            console.error('Error generating image:', error);
            loadingElement.style.display = 'none';
            showError(error.message || (currentLanguage === 'en' ? 'Failed to generate image. Please try again.' : 'Gagal menghasilkan gambar. Silakan coba lagi.'));
        }
    }
    
    function scrollToImageContainer() {
        const imageContainer = document.getElementById('generated-image-container');
        if (imageContainer) {
            imageContainer.scrollIntoView({ 
                behavior: 'smooth',
                block: 'center'
            });
        }
    }
    
    function buildFullPrompt(basePrompt) {
        let fullPrompt = basePrompt;
        
        // Add style if selected
        if (styleSelect.value) {
            fullPrompt += `, ${styleSelect.value}`;
        }
        
        // Add lighting
        if (lightingSelect.value) {
            fullPrompt += `, ${lightingSelect.value} lighting`;
        }
        
        // Add color palette
        if (colorSelect.value) {
            fullPrompt += `, ${colorSelect.value} colors`;
        }
        
        // Add composition
        if (compositionSelect.value) {
            fullPrompt += `, ${compositionSelect.value}`;
        }
        
        // Add quality
        if (qualitySelect.value !== 'normal') {
            fullPrompt += `, ${qualitySelect.value} quality`;
        }
        
        // Add HD if checked
        if (hdCheckbox.checked) {
            fullPrompt += `, ultra HD`;
        }
        
        // Add detail enhancement if checked
        if (enhanceDetailsCheckbox.checked) {
            fullPrompt += `, highly detailed`;
        }
        
        return fullPrompt;
    }
    
    async function generateBatch() {
        const prompt = promptTextarea.value.trim();
        const batchCount = parseInt(batchCountInput.value);
        
        if (!prompt) {
            showError(currentLanguage === 'en' ? 'Please enter a description for the image' : 'Silakan masukkan deskripsi untuk gambar');
            return;
        }
        
        if (isNaN(batchCount) || batchCount < 1 || batchCount > 10) {
            showError(currentLanguage === 'en' ? 'Please enter a valid batch count between 1 and 10' : 'Masukkan jumlah batch yang valid antara 1 dan 10');
            return;
        }
        
        // Scroll to image container before generation starts
        scrollToImageContainer();
        
        // Store original seed
        const originalSeed = seedInput.value || Math.floor(Math.random() * 1000000);
        
        // Disable buttons during batch generation
        generateBtn.disabled = true;
        batchGenerateBtn.disabled = true;
        batchGenerateBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${currentLanguage === 'en' ? 'Generating...' : 'Memproses...'}`;
        
        try {
            // Create a container for batch images if it doesn't exist
            let batchContainer = document.getElementById('batch-images-container');
            if (!batchContainer) {
                batchContainer = document.createElement('div');
                batchContainer.id = 'batch-images-container';
                batchContainer.className = 'batch-images-container';
                document.querySelector('.image-container').insertBefore(batchContainer, document.querySelector('.action-buttons'));
            } else {
                batchContainer.innerHTML = '';
            }
            
            // Generate multiple images
            for (let i = 0; i < batchCount; i++) {
                // Use different seeds for each image
                seedInput.value = originalSeed + i;
                
                // Generate the image
                let imageUrl;
                if (modelSelect.value === 'dall-e-3') {
                    imageUrl = await generateWithDalle(prompt);
                } else if (modelSelect.value === 'stability-ai') {
                    imageUrl = await generateWithStability(prompt);
                } else {
                    imageUrl = generateWithPollinations(prompt);
                }
                
                // Create image element
                const img = document.createElement('img');
                img.src = imageUrl;
                img.className = 'batch-image';
                img.alt = `${currentLanguage === 'en' ? 'Batch image' : 'Gambar batch'} ${i+1}`;
                
                // Add download functionality
                img.addEventListener('click', function() {
                    generatedImage.src = this.src;
                    generatedImage.style.display = 'block';
                    document.querySelectorAll('.btn').forEach(btn => btn.style.display = 'flex');
                });
                
                batchContainer.appendChild(img);
                
                // Add to history
                addToHistory(prompt, imageUrl);
            }
            
            // Hide the main generated image during batch view
            generatedImage.style.display = 'none';
            document.querySelectorAll('.btn').forEach(btn => btn.style.display = 'none');
            
        } catch (error) {
            console.error('Error generating batch:', error);
            showError(error.message || (currentLanguage === 'en' ? 'Failed to generate batch. Please try again.' : 'Gagal menghasilkan batch. Silakan coba lagi.'));
        } finally {
            // Restore original seed
            seedInput.value = originalSeed;
            
            // Re-enable buttons
            generateBtn.disabled = false;
            batchGenerateBtn.disabled = false;
            batchGenerateBtn.innerHTML = `<i class="fas fa-layer-group"></i> ${translations[currentLanguage].batchGenerate}`;
        }
    }
    
    async function generateVariation() {
        if (!currentGeneration.prompt || !generatedImage.src) {
            showError(currentLanguage === 'en' ? 'Please generate an image first before creating variations' : 'Harap hasilkan gambar terlebih dahulu sebelum membuat variasi');
            return;
        }
        
        // Scroll to image container before generation starts
        scrollToImageContainer();
        
        // Generate a new seed for the variation
        const newSeed = Math.floor(Math.random() * 1000000);
        seedInput.value = newSeed;
        
        // Update current generation state with new seed
        currentGeneration.seed = newSeed;
        
        // Hide previous image and error, show loading
        generatedImage.style.display = 'none';
        document.querySelectorAll('.btn').forEach(btn => btn.style.display = 'none');
        errorMessage.style.display = 'none';
        loadingElement.style.display = 'block';
        
        try {
            let imageUrl;
            
            if (currentGeneration.model === 'dall-e-3') {
                imageUrl = await generateWithDalle(currentGeneration.prompt);
            } else if (currentGeneration.model === 'stability-ai') {
                imageUrl = await generateWithStability(currentGeneration.prompt);
            } else {
                imageUrl = generateWithPollinations(currentGeneration.prompt);
            }
            
            // Load the image
            generatedImage.onload = function() {
                loadingElement.style.display = 'none';
                generatedImage.style.display = 'block';
                document.querySelectorAll('.btn').forEach(btn => btn.style.display = 'flex');
                
                // Scroll to image container again after image loads
                scrollToImageContainer();
                
                // Add to history
                addToHistory(currentGeneration.prompt, imageUrl);
            };
            
            generatedImage.onerror = function() {
                loadingElement.style.display = 'none';
                showError(currentLanguage === 'en' ? 'Failed to generate variation. Please try again.' : 'Gagal menghasilkan variasi. Silakan coba lagi.');
            };
            
            generatedImage.src = imageUrl;
        } catch (error) {
            console.error('Error generating variation:', error);
            loadingElement.style.display = 'none';
            showError(error.message || (currentLanguage === 'en' ? 'Failed to generate variation. Please try again.' : 'Gagal menghasilkan variasi. Silakan coba lagi.'));
        }
    }
    
    function generateWithPollinations(prompt) {
        // Get dimensions from sliders
        const width = widthSlider.value;
        const height = heightSlider.value;
        const safeFilter = safeFilterCheckbox.checked;
        let ratioParam = `?width=${width}&height=${height}&nologo=true&safe=${safeFilter}`;
        
        // Add seed if provided
        if (currentGeneration.seed) {
            ratioParam += `&seed=${currentGeneration.seed}`;
        }
        
        // Encode the prompt for URL
        const encodedPrompt = encodeURIComponent(prompt);
        
        // Generate the image URL
        return `https://image.pollinations.ai/prompt/${encodedPrompt}${ratioParam}`;
    }
    
    async function generateWithDalle(prompt) {
        const apiKey = localStorage.getItem('dalleApiKey');
        if (!apiKey) {
            throw new Error(currentLanguage === 'en' ? 'No API key provided for DALL-E 3' : 'Tidak ada kunci API yang diberikan untuk DALL-E 3');
        }
        
        // Get dimensions from sliders
        const width = parseInt(widthSlider.value);
        const height = parseInt(heightSlider.value);
        
        // DALL-E 3 only supports certain sizes
        let dalleSize;
        if (width === 1024 && height === 1024) {
            dalleSize = "1024x1024";
        } else if (width === 1792 && height === 1024) {
            dalleSize = "1792x1024";
        } else if (width === 1024 && height === 1792) {
            dalleSize = "1024x1792";
        } else {
            // Default to 1024x1024 if unsupported size
            dalleSize = "1024x1024";
        }
        
        try {
            const response = await fetch('https://api.openai.com/v1/images/generations', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: "dall-e-3",
                    prompt: prompt,
                    n: 1,
                    size: dalleSize,
                    quality: hdCheckbox.checked ? "hd" : "standard"
                })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.error?.message || (currentLanguage === 'en' ? 'Failed to generate image with DALL-E 3' : 'Gagal menghasilkan gambar dengan DALL-E 3'));
            }
            
            if (data.data && data.data[0] && data.data[0].url) {
                return data.data[0].url;
            } else {
                throw new Error(currentLanguage === 'en' ? 'No image URL returned from DALL-E 3' : 'Tidak ada URL gambar yang dikembalikan dari DALL-E 3');
            }
        } catch (error) {
            console.error('DALL-E 3 API error:', error);
            throw error;
        }
    }
    
    async function generateWithStability(prompt) {
        const apiKey = localStorage.getItem('stabilityApiKey');
        if (!apiKey) {
            throw new Error(currentLanguage === 'en' ? 'No API key provided for Stability.AI' : 'Tidak ada kunci API yang diberikan untuk Stability.AI');
        }
        
        // Get dimensions from sliders
        const width = parseInt(widthSlider.value);
        const height = parseInt(heightSlider.value);
        
        // Stability.AI has some size restrictions
        let validWidth = Math.min(Math.max(width, 512), 2048);
        let validHeight = Math.min(Math.max(height, 512), 2048);
        
        // Must be divisible by 64
        validWidth = Math.floor(validWidth / 64) * 64;
        validHeight = Math.floor(validHeight / 64) * 64;
        
        try {
            const response = await fetch('https://api.stability.ai/v1/generation/stable-diffusion-xl-1024-v1-0/text-to-image', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`,
                    'Accept': 'application/json'
                },
                body: JSON.stringify({
                    text_prompts: [
                        {
                            text: prompt,
                            weight: 1
                        }
                    ],
                    cfg_scale: 7,
                    height: validHeight,
                    width: validWidth,
                    steps: 30,
                    samples: 1,
                    seed: currentGeneration.seed || Math.floor(Math.random() * 1000000)
                })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.message || (currentLanguage === 'en' ? 'Failed to generate image with Stability.AI' : 'Gagal menghasilkan gambar dengan Stability.AI'));
            }
            
            if (data.artifacts && data.artifacts[0] && data.artifacts[0].base64) {
                return `data:image/png;base64,${data.artifacts[0].base64}`;
            } else {
                throw new Error(currentLanguage === 'en' ? 'No image data returned from Stability.AI' : 'Tidak ada data gambar yang dikembalikan dari Stability.AI');
            }
        } catch (error) {
            console.error('Stability.AI API error:', error);
            throw error;
        }
    }
    
    async function enhancePrompt() {
        const prompt = promptTextarea.value.trim();
        
        if (!prompt) {
            showError(currentLanguage === 'en' ? 'Please enter a description to enhance' : 'Silakan masukkan deskripsi untuk ditingkatkan');
            return;
        }
        
        // Show loading state
        const originalButtonHTML = enhanceBtn.innerHTML;
        enhanceBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${currentLanguage === 'en' ? 'Enhancing...' : 'Meningkatkan...'}`;
        enhanceBtn.disabled = true;
        
        // Store original prompt
        const originalPrompt = promptTextarea.value;
        
        try {
            // Create messages array for the API
            const messages = [
                { 
                    role: "system", 
                    content: "You are a prompt enhancement assistant. Improve the following AI image generation prompt while maintaining its original intent. Add relevant details about style, composition, lighting, and quality where appropriate. Return only the enhanced prompt, no additional commentary."
                },
                { 
                    role: "user", 
                    content: prompt 
                }
            ];
            
            // Clear the textarea for streaming
            promptTextarea.value = "";
            
            // Call the streaming API
            await streamChatCompletion(
                messages, 
                { 
                    model: "openai",
                    seed: Math.floor(Math.random() * 1000000)
                },
                (textChunk) => {
                    // Append each chunk to the textarea
                    promptTextarea.value += textChunk;
                    // Auto-scroll to bottom
                    promptTextarea.scrollTop = promptTextarea.scrollHeight;
                }
            );
            
        } catch (error) {
            console.error('Error enhancing prompt:', error);
            // Restore original prompt if error occurs
            promptTextarea.value = originalPrompt;
            showError(currentLanguage === 'en' ? 'Failed to enhance prompt. Please try again.' : 'Gagal meningkatkan prompt. Silakan coba lagi.');
        } finally {
            // Restore button state
            enhanceBtn.innerHTML = originalButtonHTML;
            enhanceBtn.disabled = false;
        }
    }
    
    function downloadImage() {
        if (!generatedImage.src) {
            showError(currentLanguage === 'en' ? 'No image to download' : 'Tidak ada gambar untuk diunduh');
            return;
        }
        
        // Create a temporary canvas to handle different image types
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        // Handle CORS for external images
        img.crossOrigin = 'Anonymous';
        
        img.onload = function() {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            
            // Create download link
            const link = document.createElement('a');
            const prompt = promptTextarea.value.trim().substring(0, 30).replace(/[^a-z0-9]/gi, '_').toLowerCase();
            link.download = `ai-art-${prompt || 'generated'}-${Date.now()}.png`;
            
            // Convert canvas to blob and trigger download
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                link.href = url;
                document.body.appendChild(link);
                link.click();
                
                // Clean up
                setTimeout(() => {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 100);
            }, 'image/png');
        };
        
        img.onerror = function() {
            showError(currentLanguage === 'en' ? 'Failed to process image for download' : 'Gagal memproses gambar untuk diunduh');
        };
        
        img.src = generatedImage.src;
    }
    
    function shareImage() {
        if (!generatedImage.src) {
            showError(currentLanguage === 'en' ? 'No image to share' : 'Tidak ada gambar untuk dibagikan');
            return;
        }
        
        if (navigator.share) {
            navigator.share({
                title: currentLanguage === 'en' ? 'AI Generated Art' : 'Seni Hasil AI',
                text: currentLanguage === 'en' ? 'Check out this image I created with AI: ' : 'Lihat gambar yang saya buat dengan AI: ' + promptTextarea.value.trim(),
                url: generatedImage.src
            }).catch(err => {
                console.error('Error sharing:', err);
                copyToClipboard(generatedImage.src);
            });
        } else {
            copyToClipboard(generatedImage.src);
        }
    }
    
    function copyToClipboard(text) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        
        alert(currentLanguage === 'en' ? 'Image URL copied to clipboard!' : 'URL gambar disalin ke clipboard!');
    }
    
    function remixImage() {
        if (!generatedImage.src) {
            showError(currentLanguage === 'en' ? 'No image to remix' : 'Tidak ada gambar untuk di-remix');
            return;
        }
        
        // Add some randomness to the prompt
        const currentPrompt = promptTextarea.value.trim();
        const modifiers = currentLanguage === 'en' ? [
            'in a different style',
            'with a new color scheme',
            'from a different angle',
            'with dramatic lighting',
            'as a surreal interpretation',
            'in a fantasy version'
        ] : [
            'dalam gaya yang berbeda',
            'dengan skema warna baru',
            'dari sudut yang berbeda',
            'dengan pencahayaan dramatis',
            'sebagai interpretasi surealis',
            'dalam versi fantasi'
        ];
        
        const randomModifier = modifiers[Math.floor(Math.random() * modifiers.length)];
        promptTextarea.value = currentPrompt + ', ' + randomModifier;
        
        // Generate new image
        generateImage();
    }
    
    function savePrompt() {
        const prompt = promptTextarea.value.trim();
        if (!prompt) {
            showError(currentLanguage === 'en' ? 'Please enter a prompt to save' : 'Silakan masukkan prompt untuk disimpan');
            return;
        }
        
        // Check if prompt already exists
        const existingPrompt = savedPrompts.find(p => p.prompt === prompt);
        if (existingPrompt) {
            alert(currentLanguage === 'en' ? 'This prompt is already saved!' : 'Prompt ini sudah disimpan!');
            return;
        }
        
        const promptItem = {
            prompt: prompt,
            timestamp: new Date().toISOString()
        };
        
        savedPrompts.unshift(promptItem);
        localStorage.setItem('savedPrompts', JSON.stringify(savedPrompts));
        updateSavedPromptsPanel();
        
        alert(currentLanguage === 'en' ? 'Prompt saved! You can find it in the Saved Prompts section.' : 'Prompt disimpan! Anda dapat menemukannya di bagian Prompt Tersimpan.');
    }
    
    function addToHistory(prompt, imageUrl) {
        // Check if this prompt already exists in history
        const existingIndex = generationHistory.findIndex(item => item.prompt === prompt);
        
        if (existingIndex >= 0) {
            // Remove the old entry if it exists
            generationHistory.splice(existingIndex, 1);
        }
        
        const historyItem = {
            prompt: prompt,
            imageUrl: imageUrl,
            timestamp: new Date().toISOString()
        };
        
        generationHistory.unshift(historyItem);
        if (generationHistory.length > 10) {
            generationHistory = generationHistory.slice(0, 10);
        }
        
        localStorage.setItem('generationHistory', JSON.stringify(generationHistory));
        updateHistoryPanel();
    }
    
    function updateHistoryPanel() {
        if (generationHistory.length === 0) {
            historyPanel.style.display = 'none';
            return;
        }
        
        historyPanel.style.display = 'block';
        historyList.innerHTML = '';
        
        generationHistory.forEach((item, index) => {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.innerHTML = `
                <img src="${item.imageUrl}" alt="Generated image" class="history-thumbnail">
                <div class="history-prompt">${item.prompt.substring(0, 50)}${item.prompt.length > 50 ? '...' : ''}</div>
                <div class="history-date">${new Date(item.timestamp).toLocaleDateString()}</div>
            `;
            
            historyItem.addEventListener('click', () => {
                promptTextarea.value = item.prompt;
                generatedImage.dataset.fromHistory = 'true';
                generatedImage.src = item.imageUrl;
                generatedImage.style.display = 'block';
                document.querySelectorAll('.btn').forEach(btn => btn.style.display = 'flex');
            });
            
            historyList.appendChild(historyItem);
        });
    }
    
    function resetHistory() {
        if (confirm(currentLanguage === 'en' ? 'Are you sure you want to clear your generation history? This cannot be undone.' : 'Apakah Anda yakin ingin menghapus riwayat generasi? Tindakan ini tidak dapat dibatalkan.')) {
            generationHistory = [];
            localStorage.setItem('generationHistory', JSON.stringify(generationHistory));
            updateHistoryPanel();
        }
    }
    
    function updateSavedPromptsPanel() {
        if (savedPrompts.length === 0) {
            savedPromptsPanel.style.display = 'none';
            return;
        }
        
        savedPromptsPanel.style.display = 'block';
        savedPromptsList.innerHTML = '';
        
        savedPrompts.forEach((item, index) => {
            const promptItem = document.createElement('div');
            promptItem.className = 'saved-prompt-item';
            promptItem.innerHTML = `
                <div class="saved-prompt-text">${item.prompt.substring(0, 50)}${item.prompt.length > 50 ? '...' : ''}</div>
                <div class="saved-prompt-actions">
                    <i class="fas fa-copy saved-prompt-action" title="${currentLanguage === 'en' ? 'Copy to prompt' : 'Salin ke prompt'}"></i>
                    <i class="fas fa-trash saved-prompt-action" title="${currentLanguage === 'en' ? 'Delete' : 'Hapus'}"></i>
                </div>
            `;
            
            // Add click handler for copy action
            promptItem.querySelector('.fa-copy').addEventListener('click', (e) => {
                e.stopPropagation();
                promptTextarea.value = item.prompt;
                promptTextarea.focus();
            });
            
            // Add click handler for delete action
            promptItem.querySelector('.fa-trash').addEventListener('click', (e) => {
                e.stopPropagation();
                savedPrompts.splice(index, 1);
                localStorage.setItem('savedPrompts', JSON.stringify(savedPrompts));
                updateSavedPromptsPanel();
            });
            
            // Add click handler to use the prompt
            promptItem.addEventListener('click', () => {
                promptTextarea.value = item.prompt;
            });
            
            savedPromptsList.appendChild(promptItem);
        });
    }
    
    function toggleAdvanced() {
        advancedContent.classList.toggle('show');
        advancedArrow.classList.toggle('fa-chevron-down');
        advancedArrow.classList.toggle('fa-chevron-up');
    }
    
    function toggleModelNotes() {
        modelNotesContent.classList.toggle('show');
        modelNotesArrow.classList.toggle('fa-chevron-down');
        modelNotesArrow.classList.toggle('fa-chevron-up');
    }
    
    function updateSliderFill() {
        // Update dimension sliders
        const widthValue = widthSlider.value;
        const widthPercent = (widthValue - widthSlider.min) / (widthSlider.max - widthSlider.min) * 100;
        widthSlider.style.setProperty('--range-percent', `${widthPercent}%`);
        
        const heightValue = heightSlider.value;
        const heightPercent = (heightValue - heightSlider.min) / (heightSlider.max - heightSlider.min) * 100;
        heightSlider.style.setProperty('--range-percent', `${heightPercent}%`);
    }
    
    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        const isDarkMode = document.body.classList.contains('dark-mode');
        
        if (isDarkMode) {
            darkModeToggle.innerHTML = `<i class="fas fa-sun"></i><span>${translations[currentLanguage].lightMode}</span>`;
        } else {
            darkModeToggle.innerHTML = `<i class="fas fa-moon"></i><span>${translations[currentLanguage].darkMode}</span>`;
        }
        
        localStorage.setItem('darkMode', isDarkMode);
    }
    
    function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = 'block';
        loadingElement.style.display = 'none';
    }
    
    function clearPrompt() {
        promptTextarea.value = '';
        promptTextarea.focus();
    }
    
    function handleModelChange() {
        const selectedModel = this.value;
        
        if (selectedModel === 'dall-e-3') {
            if (!localStorage.getItem('dalleApiKey')) {
                showApiKeyModal('DALL-E 3', 'sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 'https://platform.openai.com/api-keys');
                // Reset to FLUX Turbo if no API key
                resetModelToDefault();
            }
        } else if (selectedModel === 'stability-ai') {
            if (!localStorage.getItem('stabilityApiKey')) {
                showApiKeyModal('Stability.AI', 'sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 'https://platform.stability.ai/account/keys');
                // Reset to FLUX Turbo if no API key
                resetModelToDefault();
            }
        }
    }
    
    function resetModelToDefault() {
        modelSelect.value = 'pollinations';
    }
    
    function resetAllSettings() {
        if (confirm(currentLanguage === 'en' ? 'Are you sure you want to reset ALL settings? This will clear:\n- Generation history\n- Saved prompts\n- API keys\n- Dark mode preference\n\nThis action cannot be undone.' : 'Apakah Anda yakin ingin mengatur ulang SEMUA pengaturan? Ini akan menghapus:\n- Riwayat generasi\n- Prompt tersimpan\n- Kunci API\n- Preferensi mode gelap\n\nTindakan ini tidak dapat dibatalkan.')) {
            // Clear all localStorage items
            localStorage.removeItem('generationHistory');
            localStorage.removeItem('savedPrompts');
            localStorage.removeItem('dalleApiKey');
            localStorage.removeItem('stabilityApiKey');
            localStorage.removeItem('darkMode');
            localStorage.removeItem('language');
            
            // Reset state variables
            generationHistory = [];
            savedPrompts = [];
            currentLanguage = 'en';
            
            // Update UI
            updateHistoryPanel();
            updateSavedPromptsPanel();
            updateLanguage('en');
            
            // Reset dark mode to default (light)
            document.body.classList.remove('dark-mode');
            darkModeToggle.innerHTML = `<i class="fas fa-moon"></i><span>${translations.en.darkMode}</span>`;
            
            // Reset model selection to default
            modelSelect.value = 'pollinations';
            
            alert(currentLanguage === 'en' ? 'All settings have been reset to defaults.' : 'Semua pengaturan telah diatur ulang ke default.');
        }
    }
    
    // Modal functions
    function showApiKeyModal(modelName, placeholder, link) {
        apiKeyModalTitle.innerHTML = `<i class="fas fa-key"></i> ${modelName} ${currentLanguage === 'en' ? 'API Key' : 'Kunci API'}`;
        apiKeyInstructions.textContent = currentLanguage === 'en' 
            ? `To use ${modelName}, please enter your API key. Your key will be stored locally in your browser and never sent to our servers.`
            : `Untuk menggunakan ${modelName}, harap masukkan kunci API Anda. Kunci Anda akan disimpan secara lokal di browser Anda dan tidak pernah dikirim ke server kami.`;
        apiKeyInput.placeholder = placeholder;
        apiKeyProviderLink.textContent = modelName;
        apiKeyProviderLink.href = link;
        saveApiKeyBtn.textContent = currentLanguage === 'en' ? 'Save API Key' : 'Simpan Kunci API';
        cancelBtn.textContent = currentLanguage === 'en' ? 'Cancel' : 'Batal';
        
        // Update API key link text
        apiKeyLink.innerHTML = currentLanguage === 'en' 
            ? `<small>Don't have an API key? Get one from <a href="#" target="_blank" id="api-key-provider-link">the provider</a></small>`
            : `<small>Tidak punya kunci API? Dapatkan dari <a href="#" target="_blank" id="api-key-provider-link">penyedia</a></small>`;
        
        // Clear the input field
        apiKeyInput.value = '';
        
        apiKeyModal.style.display = 'flex';
    }
    
    function closeModal() {
        apiKeyModal.style.display = 'none';
        // Reset to FLUX Turbo when modal is closed without saving API key
        if (!(localStorage.getItem('dalleApiKey') && modelSelect.value === 'dall-e-3') || 
            !(localStorage.getItem('stabilityApiKey') && modelSelect.value === 'stability-ai')) {
            resetModelToDefault();
        }
    }
    
    function saveApiKey() {
        const apiKey = apiKeyInput.value.trim();
        const selectedModel = modelSelect.value;
        
        if (!apiKey) {
            alert(currentLanguage === 'en' ? 'Please enter your API key' : 'Silakan masukkan kunci API Anda');
            return;
        }
        
        // Simple validation for API key format
        if (!apiKey.startsWith('sk-')) {
            alert(currentLanguage === 'en' ? 'Please enter a valid API key (should start with "sk-")' : 'Silakan masukkan kunci API yang valid (harus dimulai dengan "sk-")');
            return;
        }
        
        // Save the API key based on the selected model
        if (selectedModel === 'dall-e-3') {
            localStorage.setItem('dalleApiKey', apiKey);
        } else if (selectedModel === 'stability-ai') {
            localStorage.setItem('stabilityApiKey', apiKey);
        }
        
        closeModal();
        
        // If the user was trying to generate an image, trigger it now
        if (promptTextarea.value.trim()) {
            generateImage();
        }
    }
});
    </script>
</body>
</html>
